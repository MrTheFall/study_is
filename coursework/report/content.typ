// Some definitions presupposed by pandoc's typst output.
#let blockquote(body) = [
  #set text( size: 0.92em )
  #block(inset: (left: 1.5em, top: 0.2em, bottom: 0.2em))[#body]
]

#let horizontalrule = [
  #line(start: (25%,0%), end: (75%,0%))
]

#let endnote(num, contents) = [
  #stack(dir: ltr, spacing: 3pt, super[#num], contents)
]
#show terms: it => {
  it.children
    .map(child => [
      #strong[#child.term]
      #block(inset: (left: 1.5em, top: -0.4em))[#child.description]
      ])
    .join()
}

#let conf(
  title: none,
  authors: none,
  date: none,
  abstract: none,
  cols: 1,
  margin: (x: 1.25in, y: 1.25in),
  paper: "us-letter",
  lang: "en",
  region: "US",
  font: (),
  fontsize: 11pt,
  sectionnumbering: none,
  doc,
) = {
  set page(
    paper: paper,
    margin: margin,
    numbering: "1",
  )
  set par(justify: true)
  set text(lang: lang,
           region: region,
           font: font,
           size: fontsize)
  set heading(numbering: sectionnumbering)

  if title != none {
    align(center)[#block(inset: 2em)[
      #text(weight: "bold", size: 1.5em)[#title]
    ]]
  }

  if authors != none {
    let count = authors.len()
    let ncols = calc.min(count, 3)
    grid(
      columns: (1fr,) * ncols,
      row-gutter: 1.5em,
      ..authors.map(author =>
          align(center)[
            #author.name \
            #author.affiliation \
            #author.email
          ]
      )
    )
  }

  if date != none {
    align(center)[#block(inset: 1em)[
      #date
    ]]
  }

  if abstract != none {
    block(inset: 2em)[
    #text(weight: "semibold")[Abstract] #h(1em) #abstract
    ]
  }

  if cols == 1 {
    doc
  } else {
    columns(cols, doc)
  }
}
// show-rule отключен: стиль документа задается в main.typ
// #show: doc => conf(
//   cols: 1,
//   doc,
// )
 
 
// Оглавление удалено, оно генерируется автоматически в main.typ
= #strong[Подробное текстовое описание предметной области:]
<подробное-текстовое-описание-предметной-области>
CRM для «Красти Крабс» — это информационная система для автоматизации
бизнес-процессов ресторана «Красти Крабс», специализирующегося на
приготовлении и продаже крабсбургеров. Она предназначена для учета
заказов, управления клиентами, контроля за запасами ингредиентов и
анализа показателей продаж. Система помогает повысить эффективность
работы ресторана, улучшить обслуживание посетителей и поддерживать
доступность возможности заказа легендарных бургеров.

Система объединяет данные о клиентах, заказах, меню, сотрудниках в
единую платформу. Это позволяет владельцу (Мистеру Крабсу)
контролировать все аспекты деятельности ресторана: от количества заказов
до остатка ингредиентов на складе.

= #strong[Зачем нужна информационная система:]
<зачем-нужна-информационная-система>
Информационная система «CRM для Красти Крабс» предназначена для
оптимизации процессов ресторанного бизнеса и повышения эффективности
легендарной закусочной мистера Крабса. Она обеспечивает централизованное
управление клиентами, заказами, меню, складом и сотрудниками. Система
помогает автоматизировать рутинные операции, сократить издержки,
повысить качество обслуживания и сделать бизнес более прозрачным и
прибыльным.

CRM не только ускоряет обслуживание гостей и экономит ресурсы, но и
создает основу для лояльности клиентов, анализа продаж и дальнейшего
роста заведения.

#strong[Основные задачи, которые решает система:]

#strong[1. Управление заказами и клиентами]

- Поддержка приёма и обработки заказов (на вынос, в зале, онлайн-заказ с
  доставкой).

- Ведение истории покупок и общих предпочтений клиентов.

- Формирование клиентской базы для программ лояльности и
  персонализированных предложений.

#strong[2. Контроль меню и ингредиентов]

- Автоматизация учёта меню: актуальные цены, состав блюд, доступность.

- Взаимосвязь заказов с остатками ингредиентов.

#strong[3. Управление сотрудниками и рабочими сменами]

- Хранение информации о персонале: роли, расписание работы, зарплаты.

- Учет производительности (например, среднее время приготовления заказа
  Спанч Бобом).

#strong[4. Финансовый учет и отчётность]

- Подсчёт дневной, недельной, месячной выручки.

- Контроль расходов на ингредиенты и зарплаты.

#strong[5. Программы лояльности]

- Реализация скидок для VIP-клиентов.

#strong[6. Мониторинг качества обслуживания]

- Сбор обратной связи от посетителей.

#strong[7. Централизованное управление и контроль владельца]

- Владелец имеет доступ к сводным данным обо всех процессах в реальном
  времени.

- Возможность контролировать персонал и состояние склада через единую
  панель.

= #strong[Требования к разрабатываемой информационной системе:]
<требования-к-разрабатываемой-информационной-системе>
#strong[Роли]

- #strong[Гость] — неавторизованный офлайн‑посетитель, может оформить заказ только на кассе через кассира; личных данных не предоставляет.

- #strong[Клиент] — авторизованный пользователь (веб/мобильный интерфейс), может оформлять онлайн‑заказы, видеть историю своих заказов и оставлять отзывы.

- #strong[Кассир] — сотрудник кассы; принимает оффлайн заказы у кассы, принимает наличные. Не имеет доступа к интерфейсам, доступным повору или управляющему.

- #strong[Повар] — сотрудник кухни; видит очередь заказов, меняет только производственные статусы («Готовится», «Готов»). Не имеет доступа к интерфейсам, доступным кассиру или управляющему.

- #strong[Управляющий] — административная роль; может просматривать статистику продаж, историю заказов и отзывов, управляет меню и персоналом. Не имеет доступа к интерфейсам, доступным повору или кассиру.


#strong[Функциональные требования]

- #strong[FR-001] Система должна позволять пользователю оформлять заказ
  (на вынос, в зале или с доставкой).

- #strong[FR-002] Система должна предоставлять пользователю доступ к
  актуальному меню с ценами и составом блюд.

- #strong[FR-003] Система должна обеспечивать возможность отслеживания
  статуса заказа.

- #strong[FR-004] Система должна предоставлять возможность оставления
  пользователем обратной связи после оформления заказа.

- #strong[FR-005] Система должна поддерживать участие пользователей в
  программе лояльности (накопление бонусов, получение скидок).

- #strong[FR-006] Система должна обеспечивать возможность редактирования
  пользователем своих персональных данных (телефон, адрес доставки,
  предпочтения).

- #strong[FR-007] Система должна предоставлять пользователю доступ к
  истории его заказов.

- #strong[FR-008] Система должна позволять сотрудникам принимать и
  обрабатывать заказы (подтверждение, изменение статуса).

- #strong[FR-009] Система должна предоставлять возможность сотрудникам
  вводить и обновлять информацию о наличии ингредиентов.

- #strong[FR-010] Система должна автоматически фиксировать время
  приготовления заказа на основе изменения статусов («Готовится» →
  «Готов»).

- #strong[FR-011] Система должна обеспечивать доступ сотрудникам к
  расписанию рабочих смен.

- #strong[FR-012] Система должна поддерживать ведение учёта проданных
  блюд.

- #strong[FR-013] Система должна показывать повару новые заказы.

- #strong[FR-014] Система должна предоставлять управляющему доступ к
  статистике продаж (дневная, недельная, месячная).

- #strong[FR-015] Система должна обеспечивать управляющему возможность
  контролировать остатки ингредиентов на складе.

- #strong[FR-016] Система должна предоставлять управляющему возможность
  управления меню (цены, состав, доступность).

- #strong[FR-017] Система должна предоставлять управляющему возможность
  управления персоналом (назначение расписания, роли, зарплаты).

- #strong[FR-018] Система должна предоставлять управляющему доступ к
  обратной связи от клиентов.

- #strong[FR-019] Система должна поддерживать кассовый сценарий оплаты
  наличными: кассир вводит сумму полученных средств, система
  рассчитывает и отображает сумму сдачи.

- #strong[FR-020] Система должна предоставлять управляющему доступ к
  расширенной статистике бизнеса: истории заказов и отзывов.

- #strong[FR-021] Система должна вести журналы (логи) действий
  сотрудников и изменений заказов.

#strong[Нефункциональные требования]

#strong[Удобство использования]

- #strong[UR-001] Система должна обеспечивать выполнение операции
  оформления заказа не более чем за 3 минуты.

- #strong[UR-002] Система должна предоставлять навигацию, позволяющую
  найти любое блюдо не более чем за 30 секунд.

#strong[Производительность]

- #strong[PR-001] Система должна загружать главный экран (меню) за ≤5
  секунд при стабильном подключении к интернету со скоростью ≥12 Мбит/с.

- #strong[PR-002] Система должна обновлять статус заказа и отображать
  изменения не позднее чем через 5 секунд.

 - #strong[PR-003] Система должна выдерживать нагрузку ≥50 запросов/с в ходе приёмочного теста TPL‑LOAD‑001 (непрерывно 10 минут).

- #strong[PR-004] Необходимо, чтобы интернет‑подключение имело
  пропускную способность не менее 12 Мбит/с.

- #strong[PR-005] Система должна обновлять информацию о состоянии
  складских остатков в течение 10 секунд после ввода изменений.


#strong[SLI/SLO/SLA для производительности]

- #strong[Определения]
  - #strong[SLI] (Service Level Indicator) - измеримая метрика качества сервиса.
  - #strong[SLO] (Service Level Objective) - целевое значение SLI.
  - #strong[SLA] (Service Level Agreement) - доля соблюдения SLO за отчётный период.

- #strong[Предпосылки измерений]
  - Подключение клиента к интернету: ≥12 Мбит/с, средняя RTT ≤100 мс.
  - Для серверных SLI учитываются только успешные ответы (HTTP 2xx/3xx).

 - #strong[SLI и SLO (пороговые, для базовых проверок)]
  - #strong[SLI‑1: menu_load_good_ratio] - good_loads(≤5 с) / total_loads; событие = одна проверка загрузки меню.
    - #strong[SLO‑1:] ≥ 98% за месяц.
  - #strong[SLI‑2: status_update_good_ratio] - good_updates(≤5 с) / total_updates; событие = одна проверка доставки статуса в UI.
    - #strong[SLO‑2:] ≥ 98% за месяц.
  - #strong[SLI‑3: inventory_propagation_good_ratio] - good_propagations(≤10 с) / total_propagations; событие = одна проверка отражения остатков.
    - #strong[SLO‑3:] ≥ 98% за месяц.
  - #strong[SLI‑4: throughput_acceptance] - проверяется только в рамках приёмочного нагрузочного теста (см. ниже), не входит в ежемесячный SLA.

- #strong[SLA и метрики]
  - Отчётный период: календарный месяц.
  - #strong[Метрика соблюдения SLA] для каждого SLI: percent_compliance = (кол‑во событий, удовлетворяющих SLO) / (все события) · 100%.
  - #strong[SLA‑уровень:] percent_compliance ≥ 98.0% по каждому из SLI‑1..3 за отчётный месяц. Нагрузочная пропускная способность (SLI‑4) проверяется однократно при приёмке.
  - #strong[Error budget:] до 2.0% событий в месяц могут превышать SLO без нарушения SLA.

 - #strong[Сбор и верификация]
  - Источник данных: замеры времени выполнения HTTP‑запросов и проверки содержания ответов.
  - Нарушение SLA фиксируется при percent_compliance < 98% по любому SLI за отчётный период.

 - #strong[Автоматические проверки]
  - #strong[P1: Загрузка меню ≤5 с] - GET главной страницы/меню; успех, если общее время ≤5 с.
    - пример: curl с измерением общего времени ответа; писать «ok», если ≤5.0 с.
  - #strong[P2: Обновление статуса заказа ≤5 с] - в тестовом заказе изменить статус и опросом 1 раз в секунду проверять, что API/страница отразила изменение ≤5 с.
    - успех, если изменение наблюдается не позже 5‑й секунды.
  - #strong[P3: Отражение остатков ≤10 с] - изменить тестовый остаток и опросом проверить, что изменение видно в API/интерфейсе ≤10 с.
  - #strong[P4: Пропускная способность (опционально для мониторинга)] - при необходимости краткий прогон; основной нагрузочный тест выполняется один раз на приёмке (см. ниже).
  - #strong[Агрегация SLA] - percent_compliance = ok/total по каждой проверке; порог 98% за месяц.

 - #strong[Нагрузочное тестирование при приёмке (однократно)]
  - #strong[Цель] - подтвердить, что система выдерживает базовую целевую нагрузку до запуска.
  - #strong[Сценарий PR‑LOAD‑001]
    - Продолжительность: 10 минут непрерывной нагрузки.
    - Нагрузка: ключевые эндпоинты - получение меню, создание заказа.
    - Критерии успешности (pass/fail):
      - Requests/sec (среднее за прогон) ≥ 50.
      - Доля ответов не‑2xx/3xx ≤ 1%.
      - 95‑й перцентиль времени ответа ≤ 5 с.
  - #strong[Фиксация результата] - сохранить summary инструмента как артефакт приёмки.


#strong[Надежность]

 - #strong[RR-002] Среднее время на устранение проблем должно составлять
  3 часа; в случае критического сбоя система должна быть восстановлена в
  течение 1 дня.


#strong[Безопасность]

- #strong[SEC-001] Система должна обеспечивать аутентификацию пользователей через Яндекс.ID.

- #strong[SEC-002] Система должна обеспечивать ролевую модель доступа
  (гость, клиент, кассир, повар, управляющий) с ограничением операций по
  ролям.

- #strong[SEC-003] Система должна быть защищена от SQL-инъекций.

- #strong[SEC-004] Использовать актуальные версии сторонних библиотек и зависимостей.

#strong[Сопровождаемость]

- #strong[MAINT-001] Кодовая база хранится в репозитории GitHub; вся разработка ведётся через ветки и pull request.

- #strong[MAINT-002] Для единообразия стиля применяется автоматическое форматирование кода (форматтер); проверка форматирования входит в проверки перед слиянием.

- #strong[MAINT-003] К качеству кода применяются правила статического анализа (линтер); наличие ошибок линтера блокирует слияние изменений.

- #strong[MAINT-004] Запуск форматтера и линтера является частью конвейера CI; при несоответствии стиль‑гайду или при ошибках конвейер помечается как неуспешный.

 - #strong[MAINT-005] Необходимо поддерживать базовые модульные тесты для ключевой функциональности; падение тестов блокирует слияние.
 
 - #strong[MAINT-006] Минимальное покрытие кода модульными тестами — не менее 50%; порог измеряется и проверяется в CI, несоответствие блокирует слияние.

#strong[CI/CD]

- #strong[CI-001] В экосистеме GitHub настраивается CI для автоматической сборки, запуска тестов и проверок качества кода при каждом push и pull request.

- #strong[CI-002] Базовый сценарий конвейера: 
  1) подготовка окружения; 
  2) сборка; 
  3) запуск линтеров; 
  4) проверка форматирования;
  5) запуск модульных тестов; 
  6) публикация артефактов сборки/отчётов как артефактов CI.

 - #strong[CI-003] Развертывание по требованию: требуется, чтобы из основной ветки репозитория можно выполнить развёртывание собранного артефакта на целевое окружение проекта.

- #strong[CI-004] Конвейер pull request должен быть зелёным (все шаги успешны), иначе слияние запрещено.

= #strong[Прецеденты:]
<прецеденты>
#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Заказ на кассе],
  [ID: 1],
  [Краткое описание: Клиент приходит в ресторан, выбирает блюда и
  оплачивает заказ у кассы. Своих личных данных клиент не сообщает.],
  [Главный актер: Клиент.],
  [Предусловия: Клиент находится в ресторане и стоит у кассы. Система
  работает и отображает актуальное меню.],
  [Основной поток: 

  + Клиент говорит кассиру, какие блюда он хочет.

  + Сотрудник кассы через систему формирует заказ.

  + Система проверяет наличие ингредиентов и добавляет блюда в чек.

  + Система рассчитывает стоимость.

  + Кассир принимает оплату наличными: вводит сумму полученных средств,
    система рассчитывает и отображает сумму сдачи; кассир выдаёт сдачу.

  + Система сохраняет заказ и передаёт его на кухню.

  ],
  [Альтернативный поток:

  3а. Если нужное блюдо недоступно:

  #block(inset: (left: 1em))[
  + Сотрудник кассы сообщает об этом клиенту.

  + Клиент выбирает другое блюдо или отказывается от заказа.
  ]

  ],
  [Постусловия: Заказ успешно создан и передан на кухню, или отменён.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Онлайн-заказ с доставкой],
  [ID: 2],
  [Краткое описание: Клиент через сайт или приложение выбирает блюда,
  указывает адрес доставки и способ оплаты. Система формирует заказ и
  передаёт курьеру.],
  [Главный актер: Клиент, Курьер.],
  [Предусловия: Клиент зашёл на сайт/приложение. Меню загружено и
  актуально.],
  [Основной поток: 

  + Клиент открывает меню.

  + Система отображает список блюд с ценами и составом.

  + Клиент добавляет выбранные позиции в корзину.

  + Клиент вводит контактные данные и адрес доставки.

  + Система рассчитывает итоговую стоимость заказа.

  + Клиент выбирает способ оплаты: онлайн (картой) или при получении
    (наличными).

  + Клиент подтверждает заказ.

  + Система сохраняет заказ и передаёт информацию курьеру.

  ],
  [Альтернативный поток:

  3а. Если выбранное блюдо недоступно:

  #block(inset: (left: 1em))[
  + Система уведомляет клиента.

  + Клиент может удалить/заменить блюдо или отменить заказ.
  ]

  6а. Если онлайн-оплата не прошла:

  #block(inset: (left: 1em))[
  + Система уведомляет клиента.

  + Клиент выбирает другой метод оплаты или отменяет заказ.
  ]

  ],
  [Постусловия: Заказ успешно создан и передан курьеру, либо отменён.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Управление складом ингредиентов],
  [ID: 3],
  [Краткое описание: Сотрудник вводит данные о приходе или расходе
  ингредиентов в систему.],
  [Главный актер: Сотрудник склада.],
  [Предусловия: Сотрудник авторизован в системе.],
  [Основной поток: 

  + Сотрудник открывает раздел «Склад».

  + Вводит количество поступивших или списанных ингредиентов.

  + Система обновляет остатки.

  + Информация становится доступна для кассы, кухни и отчётности.

  ],
  [Альтернативный поток:

  2а. Если введено некорректное значение:

  #block(inset: (left: 1em))[
  + Система уведомляет сотрудника об ошибке.

  + Сотрудник исправляет данные.
  ]

  ],
  [Постусловия: Складские данные актуализированы.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Просмотр отчёта о продажах],
  [ID: 4],
  [Краткое описание: Управляющий анализирует финансовые показатели
  заведения через отчёты в системе.],
  [Главный актер: Управляющий.],
  [Предусловия: Управляющий авторизован в системе.],
  [Основной поток: 

  + Управляющий выбирает период отчёта (день, неделя, месяц).

  + Система формирует отчёт по продажам.

  + Управляющий просматривает структуру продаж (по блюдам, сотрудникам,
    времени суток).

  + Система сохраняет факт просмотра и формирует статистику для истории.

  ],
  [Альтернативный поток:

  2а. Если данных за выбранный период нет:

  #block(inset: (left: 1em))[
  + Система уведомляет управляющего.

  + Управляющий выбирает другой период.
  ]

  ],
  [Постусловия: Управляющий получил отчёт о продажах или уведомление об
  отсутствии данных.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Регистрация клиента в системе (сайт/приложение)],
  [ID: 5],
  [Краткое описание: Новый клиент создаёт учётную запись, чтобы
  оформлять онлайн-заказы и участвовать в программе лояльности.],
  [Главный актер: Клиент.],
  [Предусловия: Сайт/приложение доступно.],
  [Основной поток: 

  1. Клиент открывает страницу регистрации.

  2. Вводит личные данные (имя, телефон, email/логин, пароль).

  3. Система проверяет корректность данных.

  4. Система создаёт новый профиль клиента.

  ],
  [Альтернативный поток:

  1а. Если данные некорректны:

  #block(inset: (left: 1em))[
  + Клиент получает уведомление

  + Клиент исправляет ошибки.
  ]

  1б. Если телефон/email уже зарегистрирован:

  #block(inset: (left: 1em))[
  + Система уведомляет клиента

  + Система предлагает вход.
  ]

  ],
  [Постусловия: Клиент зарегистрирован в системе, учётная запись создана.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Авторизация клиента в системе],
  [ID: 6],
  [Краткое описание: Клиент авторизуется для просмотра истории заказов,
  персональных данных и участия в бонусных программах.],
  [Главный актер: Клиент.],
  [Предусловия: Клиент зарегистрирован в системе.],
  [Основной поток: 

  + Клиент вводит логин и пароль.

  + Система проверяет данные.

  + В случае успешной проверки клиент получает доступ в личный кабинет.

  ],
  [Альтернативный поток:

  2а. Если данные некорректны:

  + Система сообщает об ошибке.

  + Клиент может попробовать снова или восстановить пароль.

  ],
  [Постусловия: Клиент получил доступ к системе или остался
  неавторизованным.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Управление личным кабинетом],
  [ID: 7],
  [Краткое описание: Клиент меняет свои данные (адрес доставки,
  пароль).],
  [Главный актер: Клиент.],
  [Предусловия: Клиент авторизован в системе.],
  [Основной поток: 

  + Клиент авторизуется в системе.

  + Открывает «Личный кабинет».

  + Редактирует данные.

  + Система сохраняет изменения.

  ],
  [Альтернативный поток:

  1а. Если данные некорректны:

  #block(inset: (left: 1em))[
  + Клиент получает уведомление

  + Клиент исправляет ошибки.
  ]

  ],
  [Постусловия: Данные клиента обновлены.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Управление меню],
  [ID: 8],
  [Краткое описание: Управляющий обновляет информацию о блюдах: меняет
  цену, состав и доступность.],
  [Главный актер: Управляющий.],
  [Предусловия: Управляющий авторизован в системе.],
  [Основной поток: 

  + Управляющий открывает раздел «Меню».

  + Выбирает блюдо для изменения.

  + Редактирует цену, состав или статус доступности.

  + Система сохраняет обновлённые данные и обновляет меню.

  ],
  [Альтернативный поток:

  3а. Если управляющий вводит некорректные данные:

  #block(inset: (left: 1em))[
  + Система сообщает об ошибке.

  + Управляющий корректирует данные.
  ]

  ],
  [Постусловия: Меню в системе актуализировано.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Управление персоналом],
  [ID: 9],
  [Краткое описание: Управляющий назначает роли, рабочие смены и
  зарплаты сотрудников.],
  [Главный актер: Управляющий.],
  [Предусловия: Управляющий авторизован в системе.],
  [Основной поток: 

  + Управляющий открывает раздел «Персонал».

  + Выбирает сотрудника.

  + Редактирует данные сотрудника (роль, смены, оклад).

  + Система сохраняет изменения и обновляет расписание.

  ],
  [Альтернативный поток:

  3а. При вводе некорректных данных:

  #block(inset: (left: 1em))[
  + Система сообщает об ошибке.

  + Управляющий исправляет ввод.
  ]

  ],
  [Постусловия: Информация о сотруднике актуализирована.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Отслеживание статуса онлайн-заказа],
  [ID: 10],
  [Краткое описание: Клиент отслеживает текущее состояние своего
  заказа.],
  [Главный актер: Клиент.],
  [Предусловия: Клиент оформил заказ.],
  [Основной поток: 

  + Клиент открывает раздел «Мои заказы».

  + Система отображает список заказов и их статусы.

  + Клиент просматривает информацию о своём заказе.

  ],
  [Альтернативный поток:

  2а. Если данные не загрузились:

  #block(inset: (left: 1em))[
  + Система уведомляет клиента об ошибке связи.

  + Клиент повторяет попытку позже.
  ]

  ],
  [Постусловия: Клиент получил актуальную информацию об онлайн-заказе.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Обратная связь],
  [ID: 11],
  [Краткое описание: После завершения заказа клиент оставляет отзыв о
  блюде и сервисе.],
  [Главный актер: Клиент.],
  [Предусловия: Заказ оплачен и зарегистрирован в системе.],
  [Основной поток: 

  + Клиент получает в интерфейсе предложение оставить отзыв.

  + Заполняет форму: оценку, комментарий.

  + Система сохраняет отзыв.

  + Управляющий получает доступ к обратной связи.

  ],
  [Альтернативный поток:

  2а. Клиент не оставляет отзыв:

  #block(inset: (left: 1em))[
  + Система ничего не сохраняет.
  ]

  ],
  [Постусловия: Отзыв сохранён и доступен управляющему или
  отсутствует.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Финансовый учёт],
  [ID: 12],
  [Краткое описание: Система подсчитывает выручку и расходы ресторана.],
  [Главный актер: Управляющий.],
  [Предусловия: Управляющий авторизован в системе.],
  [Основной поток: 

  + Управляющий открывает раздел «Отчёты».

  + Система формирует отчёт выручки и расходов (ингредиенты, зарплаты).

  + Управляющий просматривает итоговую статистику.

  ],
  [Альтернативный поток:

  2а. Если данных нет (например, новый день):

  #block(inset: (left: 1em))[
  + Система уведомляет управляющего об отсутствии информации.
  ]

  ],
  [Постусловия: Управляющий получил сводку финансов.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Принятие и обработка заказов],
  [ID: 13],
  [Краткое описание: Кассир принимает поступивший заказ; Повар изменяет
  только производственные статусы ("Готовится", "Готов").],
  [Главный актер: Сотрудник кассы.],
  [Предусловия: Сотрудник авторизован в системе.],
  [Основной поток: 

  + Кассир открывает список заказов.

  + Выбирает новый заказ.

  + Подтверждает приём заказа.

  + Повар в своей панели меняет производственные статусы по мере
    готовности («Готовится», «Готов»).

  + Система обновляет данные и отображает статус клиенту.

  ],
  [Альтернативный поток:

  2а. Если заказ отменён клиентом до подтверждения:

  #block(inset: (left: 1em))[
  + Система снимает заказ с обработки.
  ]

  ],
  [Постусловия: Статус заказа изменён и отображается всем
  заинтересованным сторонам.],
)
]

#align(center)[#table(
  columns: (1fr,),
  align: left,
  inset: 6pt,
  [Прецедент: Авторизация сотрудника/управляющего],
  [ID: 16],
  [Краткое описание: Сотрудник входит в систему с учётом
  своей роли доступа.],
  [Главный актер: Сотрудник кассы, Повар, Управляющий.],
  [Предусловия: Сотрудник зарегистрирован в системе.],
  [Основной поток: 

  + Сотрудник вводит логин и пароль.

  + Система проверяет данные и роль сотрудника.

  + В случае успеха система предоставляет доступ к рабочему интерфейсу в
    зависимости от роли.

  ],
  [Альтернативный поток:

  2а. Если данные некорректны:

  #block(inset: (left: 1em))[
  + Система сообщает об ошибке.

  + Пользователь может повторить попытку.
  ]

  ],
  [Постусловия: Пользователь получил доступ к системе в рамках своей
  роли или остался неавторизован.],
)
]
 
= #strong[Бизнес-процессы]

// Переверстанный шаблон бизнес-процесса в виде аккуратной карточки
#let bp(
  name: none,
  goal: none,
  actors: none,
  steps: none,
  result: none,
) = [
  #block(
    inset: 10pt,
    radius: 6pt,
    stroke: (paint: luma(0.85), thickness: 0.7pt),
    fill: luma(0.98),
  )[
    // Заголовок процесса (без попадания в оглавление)
    #text(weight: "bold", size: 1.05em)[#name]
    #v(2pt)

    // Общие настройки типографики внутри карточки
    #set par(spacing: 0.25em, leading: 1.18em)
    #set list(spacing: 0.2em)

    // Краткие сведения в двух колонках
    #grid(
      columns: (auto, 1fr),
      column-gutter: 1.2em,
      row-gutter: 0.4em,
      [#text(weight: "semibold")[Цель]], [#goal],
      [#text(weight: "semibold")[Участники]], [#actors],
    )

    #v(6pt)
    #text(weight: "semibold")[Ход процесса]
    #set enum(numbering: "1.")
    #steps

    #v(4pt)
    #grid(
      columns: (auto, 1fr),
      column-gutter: 1.2em,
      row-gutter: 0.4em,
      [#text(weight: "semibold")[Результат]], [#result],
    )
  ]
  #v(10pt)
]

#bp(
  name: [1. Приём заказа в ресторане],
  goal: [быстро принять заказ гостя и передать его на кухню.],
  actors: [Клиент; Сотрудник кассы; Повар; Система],
  steps: [
    + Клиент сообщает кассиру желаемые блюда.
    + Сотрудник кассы вносит заказ в систему.
    + Система проверяет наличие ингредиентов.
      - Если ингредиенты есть, заказ формируется.
      - Если чего-то не хватает, кассир предлагает замену.
    + Система рассчитывает стоимость.
    + Клиент оплачивает заказ наличными; кассир вводит сумму полученных
      средств и выдаёт сдачу.
    + Заказ фиксируется в системе и уходит на кухню.
  ],
  result: [Заказ создан, оплачен и готовится.],
)

#bp(
  name: [2. Онлайн-заказ с доставкой],
  goal: [предоставить клиенту возможность заказать с сайта или приложения.],
  actors: [Клиент; Курьер; Система],
  steps: [
    + Клиент открывает меню.
    + Добавляет блюда в корзину.
    + Указывает адрес и контактные данные.
    + Система рассчитывает итоговую стоимость.
    + Клиент выбирает способ оплаты: онлайн (картой) или при получении
      (наличными).
    + Система формирует заказ.
    + Заведение получает данные и сотрудники передают заказ в доставку.
  ],
  result: [заказ передан в доставку или отменён.],
)

#bp(
  name: [3. Приготовление заказа],
  goal: [обеспечить своевременное приготовление блюд.],
  actors: [Повар; Система],
  steps: [
    + Повар видит новые заказы в панели.
    + Отмечает начало приготовления — система фиксирует время.
    + Готовит заказ.
    + Отмечает статус «Готов».
    + Система сохраняет время приготовления.
  ],
  result: [заказ готов, клиент получает уведомление.],
)

#bp(
  name: [4. Управление складом ингредиентов],
  goal: [поддерживать актуальные остатки ингредиентов.],
  actors: [Сотрудник склада; Система; Управляющий],
  steps: [
    + Сотрудник вносит приход/расход ингредиентов.
    + Система обновляет остатки.
    + Информация отображается кассе и кухне.
    + При критическом остатке система уведомляет управляющего.
  ],
  result: [складские данные актуальны, принятие заказов не сбоит.],
)

#bp(
  name: [5. Управление персоналом],
  goal: [планировать рабочие смены, роли и оплату.],
  actors: [Управляющий; Система; Сотрудник кассы; Повар; Сотрудник склада; Курьер],
  steps: [
    + Управляющий открывает раздел «Персонал».
    + Назначает смены, роли, зарплаты.
    + Система сохраняет изменения.
    + Сотрудники видят актуальное расписание.
  ],
  result: [персонал распределён, план работы синхронизирован.],
)

#bp(
  name: [6. Финансовый учёт и отчётность],
  goal: [контролировать прибыль и расходы.],
  actors: [Управляющий; Система],
  steps: [
    + Система фиксирует каждую транзакцию (выручка, списания ингредиентов, оплата труда).
    + Управляющий выбирает период отчёта.
    + Система строит аналитику продаж и расходов.
    + Управляющий принимает решения (например, оптимизация затрат).
  ],
  result: [отчёт готов, есть основа для управленческих решений.],
)

#bp(
  name: [7. Программа лояльности],
  goal: [удержание клиентов.],
  actors: [Клиент; Система; Управляющий],
  steps: [
    + Клиент регистрируется в системе.
    + При заказах накапливаются бонусы или скидки.
    + Система хранит историю заказов и предпочтений.
    + Управляющий формирует акционные предложения.
  ],
  result: [клиенты возвращаются охотнее, бизнес растёт.],
)

#bp(
  name: [8. Обратная связь клиентов],
  goal: [улучшение качества сервиса.],
  actors: [Клиент; Система; Управляющий],
  steps: [
    + После заказа клиенту предлагается оставить отзыв.
    + Клиент пишет оценку и комментарий.
    + Система сохраняет отзыв.
    + Управляющий анализирует отзывы и принимает решения.
  ],
  result: [качество сервиса улучшается.],
)

= #strong[Список технологий и фреймворков:]
#strong[Технологии области представления системы]

- React v19
- Nginx v1.29.1

#strong[Технологии на серверной части]

- Spring Boot 4
- Spring Security
- PostgreSQL
- OpenAPI

#strong[Технологии для развертывания инфраструктуры]

- Docker
- Docker-compose

#strong[Технологии для обеспечения качества и надежности систем]

- JUnit5
- Mockito
- Checkstyle
- CI/CD Github Actions

= #strong[ER-модель:]
#align(center)[#image("ermodel.png", width: 100%)]


= #strong[Даталогическая модель:]
#align(center)[#image("datamodel.png", width: 100%)]


= #strong[Даталогическая модель и целостность данных:]

Реализована даталогическая модель в PostgreSQL (db/schema.sql): таблицы clients, menu_items, recipes, ingredients, ingredient_usages, inventory_records, orders, order_items, payments, employees, roles, shifts, employee_shifts, reviews, couriers.

CHECK‑ограничения: неотрицательные суммы/количества, rating 1–5, валидность статусов/типов заказа, обязательность адреса/курьера для доставки.

Индексы на все FK, а также полезные составные индексы (см. раздел про бенчмарки ниже).

#strong[Триггеры для обеспечения целостности]

- orders.updated_at - автоматическое обновление при изменении заказа.
- Пересчёт итоговой суммы заказа и проверка оплаты: recalc_order_total_and_validate() пересчитывает orders.total_amount и, при наличии успешного платежа, требует точного равенства суммы платежа итогу заказа.
- order_items_default_price - подстановка текущей цены блюда при вставке позиции, если цена не передана.
- payments_set_paid_at - BEFORE‑триггер, автоматически проставляющий paid_at при success = true.
- inventory_touch - автообновление last_updated в записях склада.
- employee_shifts_no_overlap - запрет пересекающихся смен у одного сотрудника в рамках даты.

= #strong[PL/pgSQL‑функции и процедуры:]

- place_order(client_id, type, delivery_address, items jsonb) → id заказа: создание заказа с валидацией и добавлением позиций из JSON.
- update_order_status(order_id, new_status): допустимые переходы статусов; для доставки устанавливается delivered_at.
- process_payment(order_id, method) → id платежа: единоразовый платёж на сумму заказа с success = true.
- get_kitchen_queue(): очередь кухни (заказы в confirmed/preparing с агрегированным списком позиций).
- sales_summary(from, to): выручка/средний чек за период по успешным платежам.
- top_menu_items(from, to, limit): топ блюд по количеству и выручке.
- low_stock(threshold_factor): ингредиенты ниже порога; restock_ingredient(id, delta): пополнение/коррекция остатков.

= #strong[Индексы и сравнительный анализ производительности:]

#strong[Использованные индексы]

- orders(status, created_at) - для очереди кухни (фильтр по статусам + сортировка по времени).
- orders(client_id, created_at desc, id) - покрывающий для ленты заказов клиента (index‑only scan).
- payments(paid_at) where success = true - частичный под отчёты по выручке (окна по времени).
- menu_items using gin(name gin_trgm_ops) - триграммный для ILIKE '%...%'.

#strong[Нагрузка и методика]

- Генераторы: ~10k клиентов/меню, ~50k заказов, ~100k+ позиций, ~50k платежей (db/generate_test_data.sql).
- Замеры: EXPLAIN ANALYZE, 3 прогона «до» и «после», усреднение.
- Среда: PostgreSQL 16 (Docker), scripts/benchmark.py.

#strong[Результаты замеров]

- Очередь кухни: status IN ('confirmed','preparing') ORDER BY created_at LIMIT 5000
  - До: 9.135 ms → После: 5.249 ms (≈1.7× быстрее)
  - Размер индекса: 1896 kB
- История клиента: client_id = 8471 ORDER BY created_at DESC LIMIT 1000 (covering)
  - До: 0.122 ms → После: 0.042 ms (≈2.9× быстрее)
  - Размер индекса: 2008 kB
- Выручка (30 дней): success = true AND paid_at ∈ [now()-30d, now()]
  - До: 2.823 ms → После: 2.071 ms (≈1.4× быстрее)
  - Размер индекса: 1056 kB
- Поиск по меню: name ILIKE '%Patty%'
  - До: 3.094 ms → После: 1.759 ms (≈1.8× быстрее)
  - Размер индекса: 408 kB

#strong[Выводы]

- Все индексы показали ускорение целевых запросов, при умеренной стоимости по памяти (сотни килобайт — единицы мегабайт).
- Частичный индекс по payments минимизирует размер и ускоряет агрегации в окнах времени.
- Покрывающий индекс по orders обеспечивает index‑only сканирование для ленты клиента.
- Триграммный GIN по menu_items.name сильно ускоряет гибкий поиск, что важно для UX.
- Итог: индексы целесообразны для заявленных бизнес‑процессов и подтверждены измерениями.

= #strong[Инвентаризация индексов (SQL-запрос)]:

#block(inset: 1em)[
  #set text(font: ("DejaVu Sans Mono", "Liberation Mono", "Courier New"), size: 9pt)
  SELECT
    ns.nspname AS schema,
    c.relname AS table,
    i.relname AS index,
    pg_get_indexdef(i.oid) AS indexdef,
    pg_size_pretty(pg_relation_size(i.oid)) AS index_size,
    s.idx_scan, s.idx_tup_read, s.idx_tup_fetch
  FROM pg_class c
  JOIN pg_index x ON c.oid = x.indrelid
  JOIN pg_class i ON i.oid = x.indexrelid
  JOIN pg_namespace ns ON ns.oid = c.relnamespace
  LEFT JOIN pg_stat_all_indexes s ON s.indexrelid = i.oid
  WHERE ns.nspname = 'public'
  ORDER BY pg_relation_size(i.oid) DESC;
]

#strong[Результат (топ‑20 по размеру):]

#block[
  #set text(size: 10.5pt)
  #table(
    columns: (auto, 2fr, auto, auto, auto, auto),
    stroke: 0.5pt + gray,
    inset: 4pt,
    align: left,
    [#strong[table]], [#strong[index]], [#strong[index_size]], [#strong[idx_scan]], [#strong[idx_tup_read]], [#strong[idx_tup_fetch]],
    [orders], [orders_pkey], [3320 kB], [300002], [626296], [300002],
    [orders], [idx_orders_client_id], [2344 kB], [5], [50060], [0],
    [order_items], [order_items_pkey], [2208 kB], [0], [0], [0],
    [orders], [idx_orders_client_created_at_id], [2008 kB], [4], [60], [0],
    [orders], [idx_orders_status_created_at], [1896 kB], [8], [50256], [0],
    [order_items], [idx_order_items_order_id], [1848 kB], [200001], [433339], [0],
    [orders], [idx_orders_courier_id], [1584 kB], [0], [0], [0],
    [payments], [uq_payments_order], [1560 kB], [150001], [50000], [50000],
    [payments], [idx_payments_order_id], [1560 kB], [0], [0], [0],
    [order_items], [idx_order_items_menu_item_id], [1248 kB], [0], [0], [0],
    [payments], [payments_pkey], [1112 kB], [0], [0], [0],
    [payments], [idx_payments_paid_at_success], [1056 kB], [4], [31544], [0],
    [clients], [uq_clients_email], [680 kB], [0], [0], [0],
    [menu_items], [idx_menu_items_name_trgm], [408 kB], [4], [14016], [0],
    [clients], [uq_clients_phone], [328 kB], [0], [0], [0],
    [clients], [clients_pkey], [240 kB], [262504], [262504], [262504],
    [menu_items], [menu_items_pkey], [240 kB], [100001], [100001], [100001],
    [couriers], [uq_couriers_phone], [16 kB], [0], [0], [0],
    [couriers], [couriers_pkey], [16 kB], [31853], [31853], [31853],
    [employees], [uq_employees_login], [8192 bytes], [0], [0], [0],
  )
]
